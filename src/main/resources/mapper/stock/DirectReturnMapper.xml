<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lzhpo.stock.mapper.DirectReturnMapper">
<select id="selectMathReturnNumberByReturnId" resultType="com.lzhpo.stock.entity.MathStockNumber" parameterType="java.lang.String">
		SELECT
			o.returnId,
			o. NAME name,
			sum(o.scattered_num) scatteredNum,
			sum(o.sum) numZ,
			sum(o.number) number,
			sum(o.weight) weightSum,
			sum(o.volume) volumeSum,
			CEILING(sum(o.tray)) tray
		FROM
			(
				SELECT
					d.direct_return_id returnId,
					s. system_code,
					d.item_id item_id,
					i. NAME,
					sum(d.whole_num) sum,
					sum(d.scattered_num) scattered_num,
					sum(d.number) number,
					CEILING(sum(d.number) / i.unit_rate) * i.item_weight weight,
					CEILING(sum(d.number) / i.unit_rate) * i.item_volume volume,
					CEILING(sum(d.number) / i.unit_rate) / i.tray tray
				FROM
					stock_direct_return_detail d
				LEFT JOIN material_item_clientitem i ON d.item_id = i.id
				LEFT JOIN stock_direct_return s ON d.direct_return_id = s.id
				GROUP BY
					d.direct_return_id,
					d.item_id
			) o where o.returnId = #{returnId}
		GROUP BY
			o.returnId
	</select>
</mapper>
