<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lzhpo.deliver.mapper.DispactAddressMapper">
	<select id="getDispactWaitForDeliverBill" resultType="com.lzhpo.deliver.entity.DispactAddress" parameterType="map">
		SELECT
			*
		FROM
			(
				SELECT
					*
				FROM
					deliver_dispact_address
				WHERE
					(
						dispacth_id IS NULL
						OR dispacth_id = ''
					)
				AND table_id IN (
					SELECT
						id
					FROM
						deliver_express_bill
					WHERE
						(
							(
								split = 1
								AND scheduling_status = 0
								AND STATUS = 2 /* 正常单据*/
							)
							OR (
								split = 1
								AND scheduling_status = 1
								AND STATUS = 3 /* 排过单据得余下单据*/
							)
						)
					AND del_flag = 0
				)
				UNION ALL
					SELECT
						id,
						receive_name,
						`code`,
						CODE,
						NULL,
						receive_province_id,
						receive_city_id,
						receive_area_id,
						receive_detail_area,
						deliver_bill_time,
						1,
						id,
						NULL,
						NULL,
						number,
						volume,
						weight,
						create_date,
						create_by,
						update_date,
						update_by,
						remarks,
						del_flag
					FROM
						deliver_express_bill
					WHERE
						split IS NULL
					AND scheduling_status = 0
					AND STATUS = 2
					AND del_flag = 0
					ORDER BY
						client_code DESC,
						CODE ASC
			) a
	</select>
	
	
	<select id="getDispactAddressByBillId" resultType="com.lzhpo.deliver.entity.DispactAddress"  parameterType="java.lang.String">
		SELECT
			*
		FROM
			(
				SELECT
					*
				FROM
					deliver_dispact_address
				WHERE
					(
						dispacth_id IS NULL
						OR dispacth_id = ''
					)
				AND table_id IN (
					SELECT
						id
					FROM
						deliver_express_bill
					WHERE
						(
							(
								split = 1
								AND scheduling_status = 0
								AND STATUS = 2 /* 正常单据*/
							)
							OR (
								split = 1
								AND scheduling_status = 1
								AND STATUS = 3 /* 排过单据得余下单据*/
							)
						)
					AND del_flag = 0
				)
				UNION ALL
					SELECT
						id,
						receive_name,
						`code`,
						CODE,
						NULL,
						receive_province_id,
						receive_city_id,
						receive_area_id,
						receive_detail_area,
						deliver_bill_time,
						1,
						id,
						NULL,
						NULL,
						number,
						volume,
						weight,
						create_date,
						create_by,
						update_date,
						update_by,
						remarks,
						del_flag
					FROM
						deliver_express_bill
					WHERE
						split IS NULL
					AND scheduling_status = 0
					AND STATUS = 2
					AND del_flag = 0
					ORDER BY
						client_code DESC,
						CODE ASC
			) a
			where id = #{id}
	</select>
	<select id="getDispactAddressByBillCode" resultType="com.lzhpo.deliver.entity.DispactAddress"  parameterType="java.lang.String">
		SELECT
			*
		FROM
			(
				SELECT
					*
				FROM
					deliver_dispact_address
				WHERE
					(
						dispacth_id IS NULL
						OR dispacth_id = ''
					)
				AND table_id IN (
					SELECT
						id
					FROM
						deliver_express_bill
					WHERE
						(
							(
								split = 1
								AND scheduling_status = 0
								AND STATUS = 2 /* 正常单据*/
							)
							OR (
								split = 1
								AND scheduling_status = 1
								AND STATUS = 3 /* 排过单据得余下单据*/
							)
						)
					AND del_flag = 0
				)
				UNION ALL
					SELECT
						id,
						receive_name,
						`code`,
						CODE,
						NULL,
						receive_province_id,
						receive_city_id,
						receive_area_id,
						receive_detail_area,
						deliver_bill_time,
						1,
						id,
						NULL,
						NULL,
						number,
						volume,
						weight,
						create_date,
						create_by,
						update_date,
						update_by,
						remarks,
						del_flag
					FROM
						deliver_express_bill
					WHERE
						split IS NULL
					AND scheduling_status = 0
					AND STATUS = 2
					AND del_flag = 0
					ORDER BY
						client_code DESC,
						CODE ASC
			) a
			where code = #{code}
	</select>
</mapper>
